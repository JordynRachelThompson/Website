@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

<div id="particles-js-snow"></div>
<div id="email" style="display:none">@User.Identity.Name</div>
<div id="previouslySelectedCity" style="display:none">@ViewBag.City</div>

<div style="text-align:center; margin-top:100px;"><p style="text-align:center;">@Html.Partial("_LoginPartial", 2) </p></div>
@*Current weather card*@
<div id="weatherResponse" style="color: black; width: 40%; display: none; margin-left: 10px; margin-top: -35px; float:left"></div>
<h3 id="weatherApp" style="text-align:center; color:black; font-weight: bold; margin-top:100px;">Weather App</h3>

@*7 Day Forecast / Manage UserWeatherPreferences Alerts BTNS*@
<div align="center" style="margin:30px;">
    <a id="forecastBtn" href='#' ; class="waves-effect waves-light btn-large z-depth-1 weatherBtn"><i style="color:#ff7733;" class="far fa-sun"></i><b> View 5 Day/Hourly Forecast</b></a>
    <a id="managerAlertsBtn" href='#' ; class="waves-effect waves-light btn-large z-depth-1 weatherBtn"><i style="color:#ff7733;" class="fas fa-cloud-sun"></i><b> Manage My Weather Alerts</b></a>
</div>

<div align="center" style="margin-top: 50px;">
    <h4 class="black-text"><i class="fas fa-map-marker-alt"></i> Set your City to View Weather</h4>
    <input type="text" id="city" class="weatherCityInput z-depth-3" placeholder=' enter city name...' />
    <!--Switch -->
    <div class="switch" style="display: inline-block;">
        <label>
            Off
            <input id="cityCheckbox" type="checkbox" name="cityCheckbox">
            <span class="lever"></span>
            Set City
        </label>
    </div>
    <h5 id="enterCityName" style="display: none; color:#ff7733;">Please type a city name first.</h5>

    @if (!SignInManager.IsSignedIn(User))
    {
        <h4 id="registerFirst" class="weatherHiddenBlackTxt"><i style="color:#ff7733;" class="fas fa-exclamation"></i> Please log in or register to set city preferences and manage weather alerts.</h4>
    }

    <h4 id="setCityFirst" class="weatherHiddenBlackTxt"><i style="color:#ff7733;" class="fas fa-map-pin"></i> Please set your city to view the 5 day/hourly forecast.</h4>

    @*5 Day Forecast*@
    <div id="forecast" class="black-text" style="background-color: #c3cce0 !important; display: none;">
        <h4 class="black-text">5 Day Forecast</h4>
        @*Forecast Cards*@
        <div class="row">
            <div class="col s6 offset-s3">
                <div class="card" style="background-color: #bec5d6 !important;">
                    <div class="card-content black-text">
                        <span class="card-title"><i class="fas fa-cloud"></i> Monday, Jan 01 2018</span>
                        <div>
                            <h5>description</h5>
                            <h6>High temp Low temp</h6>
                            <h6>Cloud percentage Humidity percentage</h6>
                        </div>
                    </div>
                    <div class="card-action">
                        <a id="hourlyForecastBtn" href='#' ; class="waves-effect waves-light btn-large z-depth-1 weatherBtn"><i class="far fa-clock"></i><b> Hourly Forecast</b></a>
                    </div>
                </div>
            </div>
        </div>
        @*Hourly Forecast Card*@
        <div id="hourlyForecast" class="row" style="display:none">
            <div class="col s10 offset-s2">
                @for (var i = 0; i < 10; i++)
                {
                    <div class="card col l1" style="background-color: #bec5d6 !important;">
                        <div class="card-content black-text">
                            <span class="card-title"><i class="fas fa-cloud"></i> Time</span>
                            <div>
                                <p>description</p>
                                <p>temp</p>
                                <p>Cloud percentage Humidity percentage</p>
                            </div>
                        </div>
                        <div class="card-action">
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    @*Manage Alerts*@
    <div id="manageAlerts" class="black-text" style="background-color: #c3cce0 !important; display: none;">
        <h4 class="black-text">Manage</h4>
    </div>
</div>


<style>
    body {
        background-color: #c3cce0 !important;
    }

    #particles-js-snow canvas {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: -1;
    }

    label {
        margin-left: 10px;
        font-size: 20px !important;
    }

    #weatherIcon {
        width: 55px;
        height: auto;
    }
</style>


<script src="~/js/particles.js"></script>
<script>

    SetPreselectedCity();

    //Change main 2 btn colors when clicked & hourly forecast btn
    var clickedForecast = true;
    var clickedManage = true;
    var clickedHourly = true;
    $('#forecastBtn').click(function () {
        if (clickedForecast) {
            $(this).css("cssText", "background-color: #263442 !important;");
            clickedForecast = false;
        } else {
            $(this).css("cssText", "background-color: #141d26 !important;");
            clickedForecast = true;
        }
    });

    $('#managerAlertsBtn').click(function () {
        if (clickedForecast) {
            $(this).css("cssText", "background-color: #263442 !important;");
            clickedForecast = false;
        } else {
            $(this).css("cssText", "background-color: #141d26 !important;");
            clickedForecast = true;
        }
    });
    
    $('#hourlyForecastBtn').click(function () {
        if (clickedHourly) {
            $(this).css("cssText", "background-color: #263442 !important; color: #ff7733 !important");
            clickedHourly = false;
        } else {
            $(this).css("cssText", "background-color: #141d26 !important;  color: #cfd8dc !important");
            clickedHourly = true;
        }
    });

    //5 Day Forecast Btn
    $("#forecastBtn").click(function () {
        if (($('#city').val() == "") || ($('#city').val() == " enter city name...")) {
            $('#setCityFirst').toggle();
        } else {
            $("#forecast").toggle();
            $('#setCityFirst').hide();
        }
    });

    //Hourly Forecast Btn
    $('#hourlyForecastBtn').click(function() {
        $('#hourlyForecast').toggle();
    });

    //Manage Alerts Btn
    $('#managerAlertsBtn').click(function () {
        if (($('#email').val() == "")) {
            $('#registerFirst').toggle();
        } else {
            $('#registerFirst').hide();
            if (($('#city').val() == "") || ($('#city').val() == " enter city name...")) {
                $('#setCityFirst').toggle();
            } else {
                $('#manageAlerts').toggle();
            }
        }
    });

    //Switch toggle
    $(".switch").find("input[type=checkbox]").on("change",
        function () {
            var status = $(this).prop('checked');
            if (status) {
                if ($('#city').val() !== "") {
                    $('#enterCityName').hide();
                    GetWeather($('#city').val());
                    GetForecast($('#city').val());
                } else {
                    $('#enterCityName').show();
                }
            }
            else {
                $('#city').val(" enter city name...");
                $('#weatherResponse').hide();
                $('#registerFirst').hide();
                $(this).prop('checked', false);
            }
        });

    function SetPreselectedCity() {
        var preselectedCity = "@ViewBag.City";
        if (preselectedCity != "False") {
            GetWeather(preselectedCity);
            GetForecast(preselectedCity);
            $('#cityCheckbox').prop('checked', true);
        } 
    }

    function GetWeather(selectedCity) {

        var url = '/api/Weather/City/' + selectedCity;
        $.ajax({
            url: url,
            type: 'GET',
            success: function (data) {
                var html = "<span><img id='weatherIcon' src='https://openweathermap.org/img/w/" + data.Icon + ".png'/><h6 style='display:inline; margin-right:5px; font-weight:bold'>" + data.City + "</h6></span>" +
                    "<span><i class='fas fa-thermometer-three-quarters'></i><h6 style='display:inline; margin-right:10px;'> " + data.Temp + " &deg;F " + data.Description + "</h6></span>";
                $('#weatherResponse').show();
                $('#weatherResponse').html(html);
                $('#city').val(data.City);
                $('#setCityFirst').hide();
            },
            error: function (result) {
                console.log('Error.' + result);
            }
        });
    }

    function GetForecast(selectedCity) {

        var url = '/api/Forecast/City/' + selectedCity;
        $.ajax({
            url: url,
            type: 'GET',
            success: function (data) {
                
               
            },
            error: function (result) {
                console.log('Error.' + result);
            }
        });
    }

    particlesJS("particles-js-snow", {
        "particles": {
            "number": {
                "value": 19,
                "density": {
                    "enable": true,
                    "value_area": 800
                }
            },
            "color": {
                "value": "#ffffff"
            },
            "shape": {
                "type": "circle",
                "stroke": {
                    "width": 0,
                    "color": "#000000"
                },
                "polygon": {
                    "nb_sides": 3
                },
                "image": {
                    "src": "img/github.svg",
                    "width": 80,
                    "height": 80
                }
            },
            "opacity": {
                "value": 0.9860984174322965,
                "random": true,
                "anim": {
                    "enable": false,
                    "speed": 1,
                    "opacity_min": 0.1,
                    "sync": false
                }
            },
            "size": {
                "value": 5,
                "random": true,
                "anim": {
                    "enable": false,
                    "speed": 40,
                    "size_min": 0.1,
                    "sync": false
                }
            },
            "line_linked": {
                "enable": false,
                "distance": 500,
                "color": "#ffffff",
                "opacity": 0.4,
                "width": 2
            },
            "move": {
                "enable": true,
                "speed": 4,
                "direction": "bottom-left",
                "random": false,
                "straight": false,
                "out_mode": "out",
                "bounce": false,
                "attract": {
                    "enable": false,
                    "rotateX": 600,
                    "rotateY": 1200
                }
            }
        },
        "interactivity": {
            "detect_on": "canvas",
            "events": {
                "onhover": {
                    "enable": true,
                    "mode": "bubble"
                },
                "onclick": {
                    "enable": false,
                    "mode": "repulse"
                },
                "resize": true
            },
            "modes": {
                "grab": {
                    "distance": 400,
                    "line_linked": {
                        "opacity": 0.5
                    }
                },
                "bubble": {
                    "distance": 400,
                    "size": 4,
                    "duration": 0.3,
                    "opacity": 1,
                    "speed": 3
                },
                "repulse": {
                    "distance": 200,
                    "duration": 0.4
                },
                "push": {
                    "particles_nb": 4
                },
                "remove": {
                    "particles_nb": 2
                }
            }
        },
        "retina_detect": true
    });
</script>